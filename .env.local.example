# ===========================================
# ContentForge 환경변수 설정
# ===========================================
# 이 파일을 .env.local로 복사하고 값을 채워주세요

# ----- Supabase -----
# Supabase 프로젝트 설정 > API에서 확인
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# ----- OpenAI / Gemini -----
# OpenAI 또는 OpenAI 호환 API
OPENAI_API_KEY=your-openai-api-key
# (선택) 커스텀 베이스 URL (Gemini 등)
# OPENAI_BASE_URL=https://generativelanguage.googleapis.com/v1beta/openai

# ----- Stripe -----
# Stripe Dashboard > Developers > API keys
STRIPE_SECRET_KEY=sk_test_your-test-key
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# Stripe Dashboard > Products에서 가격 ID 생성 후 입력
# Pro 플랜: $9/월 구독 상품
STRIPE_PRO_PRICE_ID=price_your-pro-price-id

# ----- App -----
# 배포된 앱 URL (Stripe 콜백용)
NEXT_PUBLIC_APP_URL=http://localhost:3000

# ===========================================
# Supabase 설정 필요 항목
# ===========================================
#
# 1. Authentication > Providers > Google 활성화
#    - Google Cloud Console에서 OAuth 2.0 클라이언트 ID 생성
#    - 승인된 리디렉션 URI: https://your-project.supabase.co/auth/v1/callback
#
# 2. SQL Editor에서 테이블 생성:
#
# -- users 테이블
# CREATE TABLE users (
#   id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
#   email TEXT NOT NULL,
#   name TEXT,
#   avatar_url TEXT,
#   tier TEXT DEFAULT 'free' CHECK (tier IN ('free', 'creator', 'pro', 'agency')),
#   monthly_generations INTEGER DEFAULT 0,
#   generation_reset_at TIMESTAMPTZ DEFAULT NOW(),
#   created_at TIMESTAMPTZ DEFAULT NOW(),
#   updated_at TIMESTAMPTZ DEFAULT NOW()
# );
#
# -- subscriptions 테이블
# CREATE TABLE subscriptions (
#   id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
#   user_id UUID UNIQUE REFERENCES users(id) ON DELETE CASCADE,
#   stripe_customer_id TEXT,
#   stripe_subscription_id TEXT,
#   stripe_price_id TEXT,
#   status TEXT DEFAULT 'inactive' CHECK (status IN ('inactive', 'active', 'canceled', 'past_due')),
#   tier TEXT DEFAULT 'free' CHECK (tier IN ('free', 'creator', 'pro', 'agency')),
#   current_period_start TIMESTAMPTZ,
#   current_period_end TIMESTAMPTZ,
#   cancel_at_period_end BOOLEAN DEFAULT FALSE,
#   created_at TIMESTAMPTZ DEFAULT NOW(),
#   updated_at TIMESTAMPTZ DEFAULT NOW()
# );
#
# -- generations 테이블
# CREATE TABLE generations (
#   id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
#   user_id UUID REFERENCES users(id) ON DELETE CASCADE,
#   source_type TEXT CHECK (source_type IN ('url', 'text')),
#   source_url TEXT,
#   source_text TEXT,
#   source_title TEXT,
#   outputs JSONB,
#   platforms TEXT[],
#   tokens_used INTEGER DEFAULT 0,
#   processing_time_ms INTEGER DEFAULT 0,
#   created_at TIMESTAMPTZ DEFAULT NOW()
# );
#
# -- RLS 활성화
# ALTER TABLE users ENABLE ROW LEVEL SECURITY;
# ALTER TABLE subscriptions ENABLE ROW LEVEL SECURITY;
# ALTER TABLE generations ENABLE ROW LEVEL SECURITY;
#
# -- RLS 정책: 본인 데이터만 접근
# CREATE POLICY "Users can read own data" ON users FOR SELECT USING (auth.uid() = id);
# CREATE POLICY "Users can update own data" ON users FOR UPDATE USING (auth.uid() = id);
# CREATE POLICY "Users can insert own data" ON users FOR INSERT WITH CHECK (auth.uid() = id);
#
# CREATE POLICY "Users can read own subscription" ON subscriptions FOR SELECT USING (auth.uid() = user_id);
# CREATE POLICY "Service can manage subscriptions" ON subscriptions FOR ALL USING (true);
#
# CREATE POLICY "Users can read own generations" ON generations FOR SELECT USING (auth.uid() = user_id);
# CREATE POLICY "Users can insert own generations" ON generations FOR INSERT WITH CHECK (auth.uid() = user_id);
#
# ===========================================
# Stripe 설정 필요 항목
# ===========================================
#
# 1. Products에서 "Pro Plan" 상품 생성
#    - 가격: $9/월, 반복 (Monthly)
#    - 생성된 가격 ID를 STRIPE_PRO_PRICE_ID에 입력
#
# 2. Webhooks 설정
#    - 엔드포인트 URL: https://your-domain.com/api/stripe/webhook
#    - 이벤트 선택:
#      - checkout.session.completed
#      - customer.subscription.updated
#      - customer.subscription.deleted
#      - invoice.payment_failed
#    - Signing secret을 STRIPE_WEBHOOK_SECRET에 입력
#
# 3. Customer Portal 설정
#    - Settings > Billing > Customer portal
#    - 구독 취소, 결제 수단 변경 등 활성화
